# JS701

**Programmation Asynchronise et Full-Stack en JavaScript **

## 0 Intro

- Tuteur: YIN Yan
- Contact: i@yinyan.fr
- Github: https://github.com/yinyanfr
- Pre-requiste
  - niveau acceptable de JavaScript ES5
- Reference pour JavaScript ES5
  - JavaScript: the Definitive Guide (rhino book)
  - JavaScript: the Good Parts (butterfly book)

<img src="https://c1.staticflickr.com/5/4066/4704268314_bb0e9d0ff3_b.jpg" />

"The good part and the rest"

## 1 Rappels

### 1.1 Programming Fonctionnel en JavaScript  

- En JavaScript, une fonction est une **variable**, de type `function`, de  prototype `Object`

  ```javascript
  var f = function(param){
      return 0
  }

  console.log(f) // <function: f>
  console.log(f()) // 0
  ```

- Utiliser fonctions comme parametres ou valeurs de retourne

  ```javascript
  var f1 = function(x, f){
    f(x*2)
  }

  f1(5, console.log) // 10

  var f2 = function(x){
      return function(y){
          return x + y
      }
  }

  console.log(f2(4)(3)) // 7

  var f3 = f2(4)
  console.log(f3(3)) // 7
  ```

- Scope de varible, et **closure** 

  - Un variable defini **hors fonction** est globale, i.e. en JavaScript **Seulement les fonction ont les scope privees**

  ```javascript
  function f(){
      var i = 0
  }

  i // undefined

  for(var i = 0; i < 10; i++){
      
  }
  i // 10
  ```

  - Def de Closure: En JavaScript, **tout les variable defini dans un scope, est visible dans son scope de fils**

    ```javascript
    var f2 = function(x){
    	// x est visible ici
        return function(y){
        	// x est visible ici
            return x + y
        }
    }
    ```

    ​

- Grammaire de ES6

  ```javascript
  // const et let
  const LENGTH = 10;
  for(let i = 0; i < 10; i++){
      
  }
  i // undefined

  // fonction lambda
  (param) => {
      
  }
  ```

  ​

### 1.2 Asyncronisation

- Evenement async sans blocke

  ```javascript
  function square(x, callback){
      setTimeout(function(){
          callback(x**x)
      }, 2000)
  }

  var l = [1,2,3,4,5,6,7,8,9];

  l.forEach(function(e){
      square(e, console.log)
  })
  ```

  ​

- Promise (ES6)

  ```javascript
  var p = new Promise(function(resolve, reject){
      setTimeout(function(){
          resolve(1)
      }, 2000)
  })

  p.then(console.log) // 1

  function square(x){
      return new Promise(function(resolve, reject){
          try{
              setTimeout(function(){
          		resolve(x**x)
      		}, 2000)
          }catch(err){
              reject(err)
          }
      })
  }

  var l = [1,2,3,4,5,6,7,8,9];

  l.forEach(function(e){
      square(e).then(
        function(success){
            console.log(success)
        },
        function(fail){
            throw fail
        }
      )
  })

  var sigmaSquare = function(arr, callback){
      var tmp = [], sum = 0;
      arr.forEach(function(e){
          tmp.push(square(e))
      })
    	Promise.all(tmp).then(function(values){
          values.forEach(function(e){
              sum += e
          });
        	callback(sum)
      })
  }

  sigmaSquare(l, console.log) // 405071317
  ```

  ​

- async/await(ES2017)

```javascript
//TODO
```

### 1.3 "Compiler" JavaScript ES6/2017 vers ES5

for old good internet explorer

// TODO

## 2. NodeJS

### 2.1 npm et modules et package.json

- Initialiser votre projet avec `$ npm init`

  Un fichier `package.json` va etre genere pour stocker les meta infos pour votre project, donc les `dependecies`

- Installer les packages sur npm et enregistrer-les comme les dependencies dans package.json

  `$ npm install --save xxx`

- Installer les programmes executable sur npm globalement

  `$ npm install -g xxx`

- les modules va etre stocker dans un repertoire `node_modules`, pour installer les modules enregistrees dans `package.json`

  `$ npm install`

### 2.2 votre propre module

```javascript
module.export = {}
```

### 2.3 importer les modules

- Les modules sur npm

```javascript
const fs = require("fs")
```

- vos propres modules

```javascript
const xxx = require("./xxx")
```

### 2.4 executer votre programme

```shell
$ node xxx.js
```

## 3 Express

### 3.1 routage

```javascript
const express = require("express")

var app = express();
app.listen(3000, () => {
    console.log("Serveur lance au port 3000")
});

// http://localhost:3000/
app.get("/", function(req, res){
    res.send("index")
})

// http://localhost:3000/user?nom=yin&cp=73000
app.get("/user", function(req, res){
    console.log(req.query.name); // 'yin'
  	console.log(req.query.cp) // '73000'
})

// http://localhost:3000/user/yin/73000
app.get("/user/:nom/:cp", function(req, res){
    console.log(req.params.name); // 'yin'
  	console.log(req.params.cp) // '73000'
})

// post
app.post("/user", function(req, res){
    console.log(req.body.name); // 'yin'
  	console.log(req.body.cp) // '73000'
})
```

### 3.2 Middleware

```javascript
app.use(function (req, res, next) {
  console.log('Time:', Date.now())
  next()
})
```

### 3.3 View Engine et template dynamique

```javascript
// TODO
// ou remplacer par JSX de react
```

## 4 MongoDB

## 5 Socket.io

## 6 React

## 7 React Native

## 8 Vue.js

## 9 Experiences pratiques de full-stack JavaScript

